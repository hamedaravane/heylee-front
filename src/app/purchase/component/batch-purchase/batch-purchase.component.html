<image-uploader [isMultiple]="true" (onMultipleFileSelected)="handleMultipleFiles($event)"></image-uploader>
<form [formGroup]="defaultProductFrom" class="mb-4">
  <nz-table nzSize="small" [nzData]="[1]" nzBordered nzTitle="مقادیر کلی">
    <thead>
    <tr>
      <th>کد</th>
      <th>نام</th>
      <th>توضیحات</th>
      <th>قیمت خرید</th>
      <th>قیمت فروش</th>
    </tr>
    </thead>
    <tbody>
    <tr>
      <td>
        <input nz-input nzSize="small" [formControl]="defaultProductFrom.controls.prefixCode" type="text" placeholder="ABC">
      </td>
      <td class="px-2">
        <input nz-input nzSize="small" [formControl]="defaultProductFrom.controls.productName" type="text">
      </td>
      <td>
        <input nz-input nzSize="small" [formControl]="defaultProductFrom.controls.productDescription" type="text">
      </td>
      <td>
        <currency-input size="small" [formControl]="defaultProductFrom.controls.defaultPurchasePrice"></currency-input>
      </td>
      <td>
        <currency-input size="small" [formControl]="defaultProductFrom.controls.defaultSellPrice"></currency-input>
      </td>
    </tr>
    </tbody>
  </nz-table>
</form>
<nz-divider></nz-divider>
<nz-table nzSize="small" nzTemplateMode="fixed" [nzBordered]="false" [nzData]="nzData">
  <thead>
  <tr>
    <!--<th></th>-->
    <th></th>
    <th>کد محصول</th>
    <th>نام محصول</th>
    <th>توضیحات</th>
    <th>رنگ</th>
    <th>سایز</th>
    <th>تعداد</th>
    <th>قیمت خرید</th>
    <th>قیمت فروش</th>
    <th></th>
  </tr>
  </thead>
  <tbody>
    @for (purchaseItem of batchPurchaseForm.controls; let i = $index; track i) {
      <tr [formGroup]="purchaseItem">
        <td>
          <img nz-image [nzSrc]="purchaseItem.value.imageSrc ?? fallbackImageBase64" [src]="purchaseItem.value.imageSrc ?? fallbackImageBase64"
               [nzFallback]="fallbackImageBase64" width="50" height="50" alt="" style="min-width: 40px" class="aspect-square object-cover">
        </td>
        <td><input nz-input nzSize="small" [formControl]="purchaseItem.controls.code"></td>
        <td><input nz-input nzSize="small" [formControl]="purchaseItem.controls.name"></td>
        <td><input nz-input nzSize="small" [formControl]="purchaseItem.controls.desc"></td>
        <td>
          <nz-select nzPlaceHolder="رنگ" nzSize="small" [formControl]="purchaseItem.controls.color">
            @for (color of colors$ | async; track $index) {
              <nz-option [nzValue]="color.id" [nzLabel]="color.label"></nz-option>
            }
          </nz-select>
        </td>
        <td>
          <nz-select nzSize="small" nzPlaceHolder="سایز" [formControl]="purchaseItem.controls.size">
            @for (size of sizes$ | async; track $index) {
              <nz-option [nzValue]="size.id" [nzLabel]="size.label"></nz-option>
            }
          </nz-select>
        </td>
        <td>
          <nz-input-number nzInputMode="number" [nzStep]="1" [nzMin]="1" nzSize="small" style="max-width: 45px"
                           [formControl]="purchaseItem.controls.quantity"></nz-input-number>
        </td>
        <td>
          <currency-input size="small" [formControl]="purchaseItem.controls.purchasePrice"></currency-input>
        </td>
        <td>
          <currency-input size="small" [formControl]="purchaseItem.controls.sellPrice"></currency-input>
        </td>
        <td>
          <a nz-button nzType="text" nzDanger nzSize="small">
            <i class="fa-xs fa-solid fa-trash"></i>
          </a>
        </td>
      </tr>
    }
  </tbody>
</nz-table>
