<div class="border border-solid border-gray-600 rounded-sm p-4 overflow-clip">
  <button nzType="primary" nz-button nzBlock (click)="isAddCustomerVisible = true">
    <i class="fa-solid fa-plus mx-2"></i>
    <span>افزودن مشتری</span>
  </button>
  <nz-divider></nz-divider>
  @if (customersIndex$ | async; as customers) {
    <ul>
      @for (customer of customers.items; track $index) {
        <li class="grid grid-cols-4 gap-y-1 mb-2 last:mb-0 text-xs rounded-sm overflow-clip border border-solid border-gray-600 p-2">
          <span class="col-span-1">شناسه</span>
          <span class="col-span-3">{{ customer.id}}</span>
          <span class="col-span-1">نام</span>
          <span class="col-span-3">{{ customer.name}}</span>
          <span class="col-span-1">شماره تماس</span>
          <span class="col-span-3" dir="ltr">{{ customer.phone}}</span>
          <span class="col-span-1">شهر</span>
          <span class="col-span-3">{{ customer.city}}</span>
          <span class="col-span-1">آدرس</span>
          <span class="col-span-3">{{ customer.address}}</span>
          @if (customer.postalCode) {
            <span class="col-span-1">کد پستی</span>
            <span class="col-span-3">{{ customer.postalCode}}</span>
          }
          @if (customer.telegram) {
            <span class="col-span-1">تلگرام</span>
            <span class="col-span-3 font-mono" dir="ltr">{{ customer.telegram}}</span>
          }
          @if (customer.instagram) {
            <span class="col-span-1">اینستاگرام</span>
            <span class="col-span-3 font-mono" dir="ltr">{{ customer.instagram}}</span>
          }
          <div class="col-span-4 mt-4">
            <div class="flex gap-2">
              <button nzType="default" nzSize="small" nzBlock nz-button>
                <i class="fa-solid fa-pen fa-xs mx-2"></i>
                <span>ویرایش</span>
              </button>
              <button nzType="default" nzSize="small" nzBlock nzDanger nz-button (click)="deleteCustomer(customer.id)">
                <i class="fa-solid fa-trash fa-xs mx-2"></i>
                <span>حذف</span>
              </button>
            </div>
          </div>
        </li>
      } @empty {
        <nz-empty nzNotFoundContent="موردی یافت نشد"></nz-empty>
      }
    </ul>
  } @else {
    <ul>
      @for (_ of [].constructor(3); track $index) {
        <li class="mb-3 last:mb-0 text-xs rounded-sm overflow-clip border border-solid border-gray-600 p-4">
          <nz-skeleton [nzActive]="true" [nzParagraph]="{ rows: 3 }"></nz-skeleton>
        </li>
      }
    </ul>
  }
</div>

<nz-drawer [nzFooter]="createCustomerFooter"
           nzClosable
           nzSize="large"
           nzPlacement="bottom"
           nzTitle="افزودن مشتری"
           [nzVisible]="isAddCustomerVisible"
           (nzOnClose)="closeAddCustomer()">
  <ng-container *nzDrawerContent>
    <form nz-form nzLabelAlign="right"
          nzLayout="vertical"
          [formGroup]="createCustomerForm"
          (ngSubmit)="createCustomer()">
      <nz-form-item>
        <nz-form-label nzRequired nzFor="name">نام مشتری</nz-form-label>
        <nz-form-control>
          <input nz-input required name="name" type="text" id="name"
                 formControlName="name"/>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzRequired nzFor="phone">شماره موبایل</nz-form-label>
        <nz-form-control dir="ltr">
          <nz-input-group nzAddOnBefore="+98">
            <input nz-input required maxlength="10" minlength="10" name="phone" type="tel" pattern="[0-9]*"
                   inputmode="numeric" id="phone" formControlName="phone"/>
          </nz-input-group>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzRequired nzFor="city">شهر</nz-form-label>
        <nz-form-control>
          <input nz-input required name="city" type="text" id="city"
                 formControlName="city"/>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzRequired nzFor="address">آدرس</nz-form-label>
        <nz-form-control>
        <textarea
          nz-input
          required
          name="address"
          id="address"
          formControlName="address"
          [nzAutosize]="{ minRows: 2, maxRows: 4 }"
        ></textarea>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzRequired nzFor="postalCode">کد پستی</nz-form-label>
        <nz-form-control dir="ltr">
            <input nz-input required maxlength="10" minlength="10" name="postalCode" type="text" pattern="[0-9]*"
                   inputmode="numeric" id="postalCode" formControlName="postalCode"/>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzFor="instagram">
          <span>اینستاگرام</span>
          <i class="fa-brands fa-instagram mx-2"></i>
        </nz-form-label>
        <nz-form-control dir="ltr">
          <nz-input-group nzAddOnBefore="instagram.com/" nzAddOnAfter="/">
            <input nz-input name="instagram" type="text" id="instagram" minlength="1" maxlength="30"
                   pattern="^[a-zA-Z0-9._]{1,30}$" formControlName="instagram"/>
          </nz-input-group>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzFor="telegram">
          <span>تلگرام</span>
          <i class="fa-brands fa-telegram mx-2"></i>
        </nz-form-label>
        <nz-form-control dir="ltr">
          <nz-input-group nzAddOnBefore="t.me/" nzAddOnAfter="/">
            <input nz-input name="telegram" type="text" id="telegram" minlength="5" maxlength="32"
                   pattern="^[a-zA-Z][a-zA-Z0-9_]{4,31}$" formControlName="telegram"/>
          </nz-input-group>
        </nz-form-control>
      </nz-form-item>
    </form>
  </ng-container>
</nz-drawer>

<ng-template #createCustomerFooter>
  <button nz-button nzBlock nzSize="large" nzType="primary" [disabled]="createCustomerForm.invalid" (click)="createCustomer()">
    <i class="fa-solid fa-plus mx-2"></i>
    <span>افزودن</span>
  </button>
</ng-template>
